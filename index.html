<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ•Šï¸ ì¢…ì´ë¹„í–‰ê¸° - ì˜¥ìƒì˜ ì—¬ìœ </title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nanum Gothic', sans-serif;
            overflow: hidden;
            background: linear-gradient(to bottom,
                #FFB347 0%,    /* ë…¸ì„ ì˜¤ë Œì§€ */
                #FFCC99 20%,   /* ì—°í•œ ë…¸ì„ */
                #87CEEB 50%,   /* í•˜ëŠ˜ìƒ‰ */
                #B0E0E6 100%   /* ì—°í•œ í•˜ëŠ˜ */
            );
            height: 100vh;
            position: relative;
        }

        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .ui-container {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 320px;
            z-index: 10;
        }

        .title {
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #555;
            margin-bottom: 15px;
        }

        #webcam-container {
            width: 280px;
            height: 210px;
            margin: 0 auto 15px;
            border-radius: 15px;
            overflow: hidden;
            background: #f0f0f0;
            position: relative;
        }

        #webcam-container canvas {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gesture-display {
            text-align: center;
            padding: 12px;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            margin: 10px 0;
            transition: all 0.3s ease;
        }

        .gesture-ready {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .gesture-throw {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            animation: pulse 0.5s;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .stats {
            background: rgba(240, 240, 240, 0.8);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 1.1em;
        }

        .stat-label {
            color: #666;
        }

        .stat-value {
            color: #333;
            font-weight: bold;
        }

        button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            color: white;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .instructions {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .instruction-item {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }

        .instruction-item:before {
            content: "âœˆï¸";
            position: absolute;
            left: 0;
        }

        .floating-message {
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(240, 248, 255, 0.9));
            padding: 25px 45px;
            border-radius: 25px;
            text-align: center;
            font-size: 1.2em;
            font-weight: 500;
            color: #4A5568;
            z-index: 20;
            opacity: 0;
            pointer-events: none;
            transition: all 0.8s ease;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            transform: translate(-50%, -50%) scale(0.8);
            max-width: 500px;
            min-width: 400px;
            line-height: 1.4;
            white-space: nowrap;
        }

        .floating-message.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .background-selector {
            margin-top: 15px;
            padding: 15px;
            background: rgba(240, 240, 240, 0.8);
            border-radius: 10px;
        }

        .bg-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .bg-btn {
            padding: 10px 12px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #495057;
            font-size: 0.9em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .bg-btn:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            transform: translateY(-1px);
        }

        .bg-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <div class="ui-container">
        <h2 class="title">ğŸ•Šï¸ ì¢…ì´ë¹„í–‰ê¸° ë‚ ë¦¬ê¸°</h2>

        <div id="webcam-container"></div>

        <div class="gesture-display gesture-ready" id="gesture-status">
            ì¹´ë©”ë¼ë¥¼ ì‹œì‘í•˜ì„¸ìš”
        </div>

        <div class="stats">
            <div class="stat-item">
                <span class="stat-label">ë‚ ë¦° ë¹„í–‰ê¸°</span>
                <span class="stat-value" id="plane-count">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">ìµœê³  ê±°ë¦¬</span>
                <span class="stat-value" id="best-distance">0m</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">í˜„ì¬ ë†’ì´</span>
                <span class="stat-value" id="current-height">ì˜¥ìƒ</span>
            </div>
        </div>

        <button class="btn-primary" onclick="startCamera()" id="camera-btn">
            ì¹´ë©”ë¼ ì‹œì‘
        </button>
        <button class="btn-secondary" onclick="toggleMusic()" id="music-btn">
            ğŸµ ë°°ê²½ìŒì•… ON
        </button>

        <div class="background-selector">
            <h3 style="margin: 15px 0 10px 0; font-size: 1em; color: #555;">ë°°ê²½ ì„ íƒ</h3>
            <div class="bg-options">
                <button class="bg-btn active" onclick="changeBackground('ì˜¥ìƒ_ë…¸ì„')" id="bg-rooftop">
                    ğŸŒ… ì˜¥ìƒ ë…¸ì„
                </button>
                <button class="bg-btn" onclick="changeBackground('ë°”ë‹¤')" id="bg-sea">
                    ğŸŒŠ ë°”ë‹¤
                </button>
                <button class="bg-btn" onclick="changeBackground('ì‚¬ë¬´ì‹¤')" id="bg-office">
                    ğŸ¢ ì‚¬ë¬´ì‹¤
                </button>
            </div>
        </div>

        <div class="instructions">
            <div class="instruction-item">ì£¼ë¨¹ ì¥ê¸°: ì¢…ì´ë¹„í–‰ê¸° ì¤€ë¹„</div>
            <div class="instruction-item">ì† í¼ì¹˜ê¸°: ë¹„í–‰ê¸° ë‚ ë¦¬ê¸°!</div>
            <div class="instruction-item">íŒŒì›Œë¥¼ ëª¨ì•„ì„œ ë©€ë¦¬ ë‚ ë ¤ë³´ì„¸ìš”!</div>
        </div>
    </div>


    <div class="floating-message" id="message">
        <p id="message-text">ë©‹ì§„ ë¹„í–‰ì´ì—ˆì–´ìš”!</p>
    </div>

    <!-- ë°°ê²½ìŒì•… -->
    <audio id="backgroundMusic" loop preload="auto" volume="0.3">
        <source src="í‰í™”ë¡œìš´_ë‚ .mp3" type="audio/mpeg">
        ë¸Œë¼ìš°ì €ê°€ ì˜¤ë””ì˜¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    </audio>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

    <script>
        // Canvas ì„¤ì •
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Teachable Machine ì„¤ì •
        const URL = "https://teachablemachine.withgoogle.com/models/oc2rOMkcD/";
        let model, webcam, isModelReady = false;

        // ê²Œì„ ìƒíƒœ
        let airplanes = [];
        let birds = [];
        let clouds = [];
        let buildings = [];
        let stars = [];
        let planeCount = 0;
        let bestDistance = 0;
        let musicPlaying = false;

        // ì œìŠ¤ì²˜ ìƒíƒœ
        let currentGesture = 'neutral';
        let lastGesture = 'neutral';
        let isHolding = false;
        let holdPower = 0;

        // ì¤€ë¹„ ì¤‘ì¸ ë¹„í–‰ê¸°
        let readyPlane = null;

        // ë°”ëŒ ì œê±°ë¨

        // ì‹œê°„ (ë…¸ì„ íš¨ê³¼)
        let timeOfDay = 0.7; // 0: ë°¤, 0.5: ë‚®, 0.7: ë…¸ì„

        // ì´ˆê¸°í™”
        function init() {
            createBuildings();
            animate();
        }

        // ê±´ë¬¼ ìƒì„± (ìœ„ì—ì„œ ë³¸ ëª¨ìŠµ)
        function createBuildings() {
            const rows = 8;
            const cols = 6;
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    const x = (canvas.width / cols) * col + Math.random() * 30;
                    const y = (canvas.height / rows) * row + Math.random() * 30;
                    const size = Math.random() * 60 + 40;

                    buildings.push({
                        x: x,
                        y: y,
                        size: size,
                        height: Math.random() * 100 + 50,
                        color: `hsl(210, 20%, ${30 + Math.random() * 20}%)`,
                        roofColor: `hsl(20, 30%, ${40 + Math.random() * 20}%)`,
                        windows: Math.random() > 0.3
                    });
                }
            }
        }

        // êµ¬ë¦„ ìƒì„±
        function createClouds() {
            for (let i = 0; i < 8; i++) {
                clouds.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * (canvas.height * 0.3),
                    size: Math.random() * 40 + 30,
                    speed: Math.random() * 0.3 + 0.1,
                    opacity: Math.random() * 0.3 + 0.3
                });
            }
        }

        // ìƒˆ ìƒì„±
        function createBirds() {
            for (let i = 0; i < 5; i++) {
                birds.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * (canvas.height * 0.4),
                    vx: Math.random() * 2 + 1,
                    vy: Math.sin(Date.now() * 0.001) * 0.5,
                    size: Math.random() * 5 + 3,
                    wingPhase: Math.random() * Math.PI * 2
                });
            }
        }

        // ë³„ ìƒì„±
        function createStars() {
            for (let i = 0; i < 100; i++) {
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * (canvas.height * 0.5),
                    size: Math.random() * 2,
                    twinkle: Math.random() * Math.PI * 2
                });
            }
        }

        // ì¹´ë©”ë¼ ì‹œì‘
        async function startCamera() {
            try {
                document.getElementById('camera-btn').disabled = true;
                document.getElementById('gesture-status').textContent = 'ëª¨ë¸ ë¡œë”© ì¤‘...';

                // ê¸°ì¡´ ëª¨ë¸ ì™„ì „ ì œê±°
                if (model) {
                    model.dispose();
                    model = null;
                }

                // ëœë¤ ìºì‹œ ë²„ìŠ¤í„°ë¡œ ê°•ì œ ìƒˆë¡œ ë‹¤ìš´ë¡œë“œ
                const cacheBuster = Math.random().toString(36).substring(7) + Date.now();
                const modelURL = URL + "model.json?v=" + cacheBuster;
                const metadataURL = URL + "metadata.json?v=" + cacheBuster;

                console.log('ì—…ë°ì´íŠ¸ëœ ëª¨ë¸ì„ ë‹¤ì‹œ ë¡œë“œ ì¤‘...', modelURL);

                // tmImage.loadë¥¼ ì§ì ‘ ì‚¬ìš© (CORS ë¬¸ì œ íšŒí”¼)
                model = await tmImage.load(modelURL, metadataURL);

                const flip = true;
                webcam = new tmImage.Webcam(280, 210, flip);
                await webcam.setup();
                await webcam.play();

                document.getElementById("webcam-container").appendChild(webcam.canvas);

                isModelReady = true;
                document.getElementById('gesture-status').textContent = 'âœ‹ ì†ì„ ë³´ì—¬ì£¼ì„¸ìš”';

                predictLoop();

            } catch (error) {
                console.error("ì¹´ë©”ë¼ ì‹œì‘ ì˜¤ë¥˜:", error);
                document.getElementById('gesture-status').textContent = 'ì˜¤ë¥˜ ë°œìƒ!';
                document.getElementById('camera-btn').disabled = false;
            }
        }

        // ì œìŠ¤ì²˜ ì˜ˆì¸¡
        async function predictLoop() {
            if (!isModelReady) return;

            webcam.update();
            const prediction = await model.predict(webcam.canvas);

            let highestPrediction = { className: '', probability: 0 };
            for (const pred of prediction) {
                if (pred.probability > highestPrediction.probability) {
                    highestPrediction = pred;
                }
            }

            const gestureStatus = document.getElementById('gesture-status');

            if (highestPrediction.probability > 0.7) {
                const className = highestPrediction.className.toLowerCase();

                if (className.includes('ì£¼ë¨¹')) {
                    currentGesture = 'fist';

                    if (!isHolding) {
                        isHolding = true;
                        holdPower = 0;

                        // ì¢…ì´ë¹„í–‰ê¸° ì¤€ë¹„ (ì˜¥ìƒ ìœ„ì¹˜ì— ë§ì¶¤)
                        readyPlane = {
                            x: canvas.width / 2,
                            y: canvas.height - 80,
                            size: 60,
                            angle: 0,
                            opacity: 1,
                            wobble: 0
                        };
                    }

                    // íŒŒì›Œ ì¦ê°€
                    holdPower = Math.min(holdPower + 2, 100);

                    gestureStatus.textContent = `âœŠ ì¤€ë¹„! íŒŒì›Œ: ${Math.floor(holdPower)}%`;
                    gestureStatus.className = 'gesture-display gesture-ready';

                } else if (className.includes('í¼ì¹˜ê¸°')) {

                    if (isHolding && holdPower > 20 && readyPlane) {
                        // ë¹„í–‰ê¸° ë‚ ë¦¬ê¸°!
                        throwAirplane(holdPower);
                        gestureStatus.textContent = 'âœ‹ ë‚ ë ¸ì–´ìš”!';
                        gestureStatus.className = 'gesture-display gesture-throw';

                        showMessage(getThrowMessage(holdPower));
                    }

                    currentGesture = 'open';
                    isHolding = false;
                    holdPower = 0;
                    readyPlane = null;

                    setTimeout(() => {
                        if (currentGesture === 'open') {
                            gestureStatus.textContent = 'âœ‹ ë‹¤ì‹œ ì£¼ë¨¹ì„ ì¥ì–´ë³´ì„¸ìš”';
                            gestureStatus.className = 'gesture-display gesture-ready';
                        }
                    }, 1500);

                } else {
                    currentGesture = 'neutral';
                    isHolding = false;
                    holdPower = 0;
                    readyPlane = null;
                    gestureStatus.textContent = 'ğŸ‘€ ì†ì„ ë³´ì—¬ì£¼ì„¸ìš”';
                    gestureStatus.className = 'gesture-display gesture-ready';
                }

                lastGesture = currentGesture;
            }

            window.requestAnimationFrame(predictLoop);
        }

        // ë¹„í–‰ê¸° ë‚ ë¦¬ê¸°
        function throwAirplane(power) {
            if (!readyPlane) return;

            const speed = (power / 100) * 8 + 4;
            const direction = (Math.random() - 0.5) * Math.PI / 6; // -30ë„ ~ +30ë„ë¡œ ì¤„ì„
            const initialSway = (Math.random() - 0.5) * 1.5; // ì´ˆê¸° í”ë“¤ë¦¼ ì¤„ì„

            airplanes.push({
                x: readyPlane.x,
                y: readyPlane.y,
                z: 0,
                vx: Math.sin(direction) * speed * 0.3 + initialSway, // ì¢Œìš° ì›€ì§ì„ ì¤„ì„
                vy: -Math.cos(direction) * speed, // ì•ìœ¼ë¡œ ê°€ëŠ” ì†ë„ëŠ” ìœ ì§€
                vz: speed * 0.4,
                size: readyPlane.size,
                trail: [],
                distance: 0,
                opacity: 1,
                rotation: 0,
                thrown: Date.now(),
                launching: true,
                // ë¶€ë“œëŸ¬ìš´ ë¹„í–‰ íŒ¨í„´
                swayPhase: Math.random() * Math.PI * 2,
                swaySpeed: Math.random() * 0.03 + 0.01, // ì†ë„ ì¤„ì„
                swayIntensity: Math.random() * 0.5 + 0.3, // ê°•ë„ ì¤„ì„
                spiralPhase: Math.random() * Math.PI * 2,
                spiralSpeed: Math.random() * 0.02 + 0.005 // ì†ë„ ì¤„ì„
            });

            planeCount++;
            document.getElementById('plane-count').textContent = planeCount;
        }

        // ë˜ì§€ê¸° ë©”ì‹œì§€
        function getThrowMessage(power) {
            const messages = {
                low: [
                    "ê±±ì •ì„ ì‹¤ì–´ ë‚ ë ¤ë³´ë‚´ì ğŸ’­",
                    "ì˜¤ëŠ˜ë„ ê³ ìƒí–ˆì–´, ì´ì œ ì‰¬ì–´ ğŸŒ¸",
                    "ë°”ì˜ë˜ ë§ˆìŒì„ ì˜ ë‚ ë ¤ë³´ëƒˆë„¤ âœ¨"
                ],
                medium: [
                    "ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë‚ ë ¤ë³´ë‚´ê³  ë§ˆìŒì´ ê°€ë²¼ì›Œì¡Œì–´ ğŸƒ",
                    "í˜ë“¤ì—ˆë˜ ì˜¤ëŠ˜ì„ ì´ë ‡ê²Œ ë§ˆë¬´ë¦¬í•˜ì ğŸŒ…",
                    "ë¶ˆì•ˆí•œ ë§ˆìŒì„ í•˜ëŠ˜ì— ë§¡ê¸°ê³  ê°€ì ğŸ¤—"
                ],
                high: [
                    "ìˆëŠ” ê·¸ëŒ€ë¡œì˜ ë‚´ ëª¨ìŠµì´ ì˜ˆë» ğŸŒˆ",
                    "ì˜¤ëŠ˜ í•˜ë£¨ë„ ì˜ ë²„í…¨ëƒˆì–´, ìˆ˜ê³ í–ˆì–´ â˜ï¸",
                    "ë‚´ê°€ ë„ˆì˜ ê°€ì¥ í° ì‘ì›ìì•¼ â¤ï¸"
                ],
                perfect: [
                    "ë‚´ì¼ì€ ì˜¤ëŠ˜ë³´ë‹¤ ë” ì¢‹ì€ ë‚ ì´ ë  ê±°ì•¼ ğŸŒŸ",
                    "ë‚˜ë¥¼ ì†Œì¤‘í•˜ê²Œ ìƒê°í•˜ëŠ” ì‚¬ëŒì´ ì—¬ê¸° ìˆì–´ âœ¨",
                    "í˜ë“¤ì–´ë„ ì˜ ê²¬ë””ê³  ìˆëŠ” ë‚˜ì—ê²Œ ë°•ìˆ˜ë¥¼ ğŸ‘"
                ]
            };

            let category;
            if (power < 30) category = messages.low;
            else if (power < 60) category = messages.medium;
            else if (power < 80) category = messages.high;
            else category = messages.perfect;

            return category[Math.floor(Math.random() * category.length)];
        }

        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(text) {
            const messageEl = document.getElementById('message');
            const messageText = document.getElementById('message-text');

            messageText.textContent = text;
            messageEl.classList.add('show');

            setTimeout(() => {
                messageEl.classList.remove('show');
            }, 3500); // ë” ì˜¤ë˜ í‘œì‹œ
        }


        // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // ë°°ê²½ (ìœ„ì—ì„œ ë³¸ ë„ì‹œ)
            drawCityFromAbove();

            // ë¹„í–‰ê¸° ê·¸ë¦¬ê¸°
            drawAirplanes();

            // ì¤€ë¹„ ì¤‘ì¸ ë¹„í–‰ê¸° ê·¸ë¦¬ê¸° (ë§¨ ìœ„ì—)
            drawReadyPlane();

            requestAnimationFrame(animate);
        }

        // ì´ë¯¸ì§€ë“¤
        let backgroundImage = null;
        let planeImage = null;
        let currentBackground = 'ì˜¥ìƒ_ë…¸ì„';

        // ì´ë¯¸ì§€ ë¡œë“œ
        function loadImages() {
            // ë°°ê²½ ì´ë¯¸ì§€
            loadBackgroundImage(currentBackground);

            // ì¢…ì´ë¹„í–‰ê¸° ì´ë¯¸ì§€
            planeImage = new Image();
            planeImage.src = 'image/ì¢…ì´ë¹„í–‰ê¸°.png';
            planeImage.onload = function() {
                console.log('ì¢…ì´ë¹„í–‰ê¸° ì´ë¯¸ì§€ ë¡œë“œ ì™„ë£Œ:', planeImage.src);
            };
            planeImage.onerror = function(e) {
                console.log('ì¢…ì´ë¹„í–‰ê¸° ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:', planeImage.src);
                console.error('ì˜¤ë¥˜:', e);
                planeImage = null;
            };
            console.log('ì¢…ì´ë¹„í–‰ê¸° ì´ë¯¸ì§€ ë¡œë“œ ì‹œì‘:', planeImage.src);
        }

        // ë°°ê²½ ì´ë¯¸ì§€ ë¡œë“œ í•¨ìˆ˜
        function loadBackgroundImage(bgName) {
            backgroundImage = new Image();
            backgroundImage.src = `image/${bgName}.png`;
            backgroundImage.onload = function() {
                console.log('ë°°ê²½ ì´ë¯¸ì§€ ë¡œë“œ ì™„ë£Œ:', backgroundImage.src);
            };
            backgroundImage.onerror = function(e) {
                console.log('ë°°ê²½ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:', backgroundImage.src);
                console.error('ì˜¤ë¥˜:', e);
                backgroundImage = null;
            };
            console.log('ë°°ê²½ ì´ë¯¸ì§€ ë¡œë“œ ì‹œì‘:', backgroundImage.src);
        }

        // ë°°ê²½ ë³€ê²½ í•¨ìˆ˜
        function changeBackground(bgName) {
            currentBackground = bgName;
            loadBackgroundImage(bgName);

            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.bg-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`bg-${bgName === 'ì˜¥ìƒ_ë…¸ì„' ? 'rooftop' : bgName === 'ë°”ë‹¤' ? 'sea' : 'office'}`).classList.add('active');

            // ë†’ì´ ì •ë³´ ì—…ë°ì´íŠ¸
            const heightElement = document.getElementById('current-height');
            switch(bgName) {
                case 'ì˜¥ìƒ_ë…¸ì„':
                    heightElement.textContent = 'ì˜¥ìƒ';
                    break;
                case 'ë°”ë‹¤':
                    heightElement.textContent = 'í•´ë³€';
                    break;
                case 'ì‚¬ë¬´ì‹¤':
                    heightElement.textContent = 'ì‚¬ë¬´ì‹¤';
                    break;
            }
        }

        // ë„ì‹œë¥¼ ìœ„ì—ì„œ ë³¸ ëª¨ìŠµ
        function drawCityFromAbove() {
            if (backgroundImage && backgroundImage.complete) {
                // ì´ë¯¸ì§€ë¥¼ ìº”ë²„ìŠ¤ ì „ì²´ì— ë§ì¶¤
                ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
            } else {
                // ê¸°ë³¸ ë°°ê²½ (ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ì‹œ)
                const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height * 0.4);
                skyGradient.addColorStop(0, '#FF6B6B');
                skyGradient.addColorStop(0.3, '#FFB347');
                skyGradient.addColorStop(0.6, '#FFCC99');
                skyGradient.addColorStop(1, '#87CEEB');
                ctx.fillStyle = skyGradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height * 0.4);

                // êµ¬ë¦„ ê·¸ë¦¬ê¸°
                drawClouds();

                // ì˜¥ìƒê³¼ ë„ì‹œ ë°°ê²½ (ë” ë‚®ê²Œ)
                const groundGradient = ctx.createLinearGradient(0, canvas.height * 0.6, 0, canvas.height);
                groundGradient.addColorStop(0, '#8B7355');
                groundGradient.addColorStop(0.1, '#A0826D');
                groundGradient.addColorStop(0.3, '#6B5B45');
                groundGradient.addColorStop(1, '#4A4035');
                ctx.fillStyle = groundGradient;
                ctx.fillRect(0, canvas.height * 0.6, canvas.width, canvas.height * 0.4);

                // ì˜¥ìƒ íƒ€ì¼ íŒ¨í„´
                ctx.strokeStyle = 'rgba(0, 0, 0, 0.1)';
                ctx.lineWidth = 1;

                // ì˜¥ìƒ ì˜ì—­ì—ë§Œ íƒ€ì¼ (ë” ì•„ë˜ìª½ì—)
                for (let x = 0; x < canvas.width; x += 40) {
                    ctx.beginPath();
                    ctx.moveTo(x, canvas.height * 0.65);
                    ctx.lineTo(x, canvas.height);
                    ctx.stroke();
                }

                for (let y = canvas.height * 0.65; y < canvas.height; y += 40) {
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(canvas.width, y);
                    ctx.stroke();
                }

                // ì˜¥ìƒ ë‚œê°„
                ctx.fillStyle = '#666';
                ctx.fillRect(0, canvas.height * 0.62, canvas.width, 5);
                ctx.fillRect(0, canvas.height * 0.62, 5, canvas.height);
                ctx.fillRect(canvas.width - 5, canvas.height * 0.62, 5, canvas.height);

                // ë„ì‹œ ìŠ¤ì¹´ì´ë¼ì¸ (ë©€ë¦¬ ë³´ì´ëŠ” ê±´ë¬¼ë“¤)
                drawDistantCity();

                // ì˜¥ìƒ ìœ„ ì˜¤ë¸Œì íŠ¸ë“¤
                drawRooftopObjects();
            }
        }

        // êµ¬ë¦„ ê·¸ë¦¬ê¸° (ê³ ì • ìœ„ì¹˜)
        function drawClouds() {
            const clouds = [
                { x: canvas.width * 0.2, y: 80 },
                { x: canvas.width * 0.5, y: 60 },
                { x: canvas.width * 0.7, y: 100 },
                { x: canvas.width * 0.9, y: 70 },
                { x: canvas.width * 0.1, y: 120 }
            ];

            clouds.forEach(cloud => {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
                ctx.beginPath();
                ctx.arc(cloud.x, cloud.y, 30, 0, Math.PI * 2);
                ctx.arc(cloud.x - 20, cloud.y, 25, 0, Math.PI * 2);
                ctx.arc(cloud.x + 20, cloud.y, 25, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // ë©€ë¦¬ ë³´ì´ëŠ” ë„ì‹œ (ê³ ì • ê±´ë¬¼ë“¤)
        function drawDistantCity() {
            // ë¯¸ë¦¬ ì •ì˜ëœ ê±´ë¬¼ ë†’ì´ë“¤
            const buildingHeights = [45, 70, 55, 85, 60, 90, 40, 65, 80, 50];

            buildingHeights.forEach((height, i) => {
                const x = i * (canvas.width / 10);
                const y = canvas.height * 0.6 - height;
                const width = canvas.width / 12;

                // ê±´ë¬¼ ì‹¤ë£¨ì—£
                ctx.fillStyle = 'rgba(50, 50, 70, 0.3)';
                ctx.fillRect(x, y, width, height);

                // ê±´ë¬¼ ì°½ë¬¸ ë¶ˆë¹› (ê³ ì •)
                ctx.fillStyle = 'rgba(255, 255, 150, 0.5)';
                const windowPattern = [
                    [1, 0, 1],
                    [0, 1, 0],
                    [1, 1, 1],
                    [0, 0, 1]
                ];

                for (let j = 0; j < 3; j++) {
                    for (let k = 0; k < Math.floor(height / 15) && k < 4; k++) {
                        if (windowPattern[k] && windowPattern[k][j]) {
                            ctx.fillRect(
                                x + 5 + j * 10,
                                y + 5 + k * 15,
                                5,
                                5
                            );
                        }
                    }
                }
            });
        }

        // ì˜¥ìƒ ì˜¤ë¸Œì íŠ¸ë“¤
        function drawRooftopObjects() {
            // í™”ë¶„ë“¤ (ìœ„ì¹˜ ì¡°ì •)
            const plants = [
                { x: 100, y: canvas.height * 0.8 },
                { x: 300, y: canvas.height * 0.75 },
                { x: canvas.width - 200, y: canvas.height * 0.85 }
            ];

            plants.forEach(plant => {
                // í™”ë¶„
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(plant.x - 25, plant.y, 50, 40);

                // ì‹ë¬¼
                ctx.fillStyle = '#228B22';
                ctx.beginPath();
                ctx.moveTo(plant.x, plant.y);
                ctx.lineTo(plant.x - 20, plant.y - 30);
                ctx.lineTo(plant.x, plant.y - 20);
                ctx.lineTo(plant.x + 20, plant.y - 35);
                ctx.lineTo(plant.x, plant.y - 15);
                ctx.closePath();
                ctx.fill();
            });

            // ë²¤ì¹˜ (ìœ„ì¹˜ ì¡°ì •)
            ctx.fillStyle = '#654321';
            ctx.fillRect(canvas.width / 2 - 80, canvas.height * 0.9, 160, 10);
            ctx.fillRect(canvas.width / 2 - 70, canvas.height * 0.9 + 10, 10, 20);
            ctx.fillRect(canvas.width / 2 + 60, canvas.height * 0.9 + 10, 10, 20);
        }

        // í•˜ëŠ˜ ê·¸ë¦¬ê¸°
        function drawSky() {
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);

            if (timeOfDay > 0.6 && timeOfDay < 0.8) {
                // ë…¸ì„
                gradient.addColorStop(0, '#FFB347');
                gradient.addColorStop(0.3, '#FFCC99');
                gradient.addColorStop(0.7, '#87CEEB');
                gradient.addColorStop(1, '#B0E0E6');
            } else if (timeOfDay > 0.3 && timeOfDay <= 0.6) {
                // ë‚®
                gradient.addColorStop(0, '#87CEEB');
                gradient.addColorStop(1, '#E0F6FF');
            } else {
                // ë°¤
                gradient.addColorStop(0, '#0C1445');
                gradient.addColorStop(1, '#183059');
            }

            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        // ë³„ ê·¸ë¦¬ê¸°
        function drawStars() {
            stars.forEach(star => {
                star.twinkle += 0.05;
                const brightness = Math.sin(star.twinkle) * 0.5 + 0.5;

                ctx.fillStyle = `rgba(255, 255, 255, ${brightness * 0.8})`;
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // ìƒˆ ê·¸ë¦¬ê¸°
        function drawBirds() {
            birds.forEach(bird => {
                bird.x += bird.vx;
                bird.y += Math.sin(Date.now() * 0.001 + bird.wingPhase) * 0.5;

                if (bird.x > canvas.width + 20) {
                    bird.x = -20;
                    bird.y = Math.random() * (canvas.height * 0.4);
                }

                ctx.save();
                ctx.translate(bird.x, bird.y);

                ctx.fillStyle = '#333';

                // ëª¸í†µ
                ctx.beginPath();
                ctx.ellipse(0, 0, bird.size, bird.size * 0.5, 0, 0, Math.PI * 2);
                ctx.fill();

                // ë‚ ê°œ
                const wingAngle = Math.sin(Date.now() * 0.01 + bird.wingPhase) * 0.3;

                ctx.beginPath();
                ctx.moveTo(-bird.size, 0);
                ctx.lineTo(-bird.size * 2, -bird.size * Math.sin(wingAngle));
                ctx.lineTo(-bird.size, -bird.size * 0.3);
                ctx.closePath();
                ctx.fill();

                ctx.beginPath();
                ctx.moveTo(bird.size, 0);
                ctx.lineTo(bird.size * 2, -bird.size * Math.sin(wingAngle));
                ctx.lineTo(bird.size, -bird.size * 0.3);
                ctx.closePath();
                ctx.fill();

                ctx.restore();
            });
        }

        // ê±´ë¬¼ ê·¸ë¦¬ê¸°
        function drawBuildings() {
            buildings.forEach(building => {
                // ê±´ë¬¼ ë³¸ì²´
                ctx.fillStyle = building.color;
                ctx.fillRect(
                    building.x,
                    canvas.height - building.height,
                    building.width,
                    building.height
                );

                // ì°½ë¬¸
                building.windows.forEach(window => {
                    if (window.lit) {
                        ctx.fillStyle = 'rgba(255, 255, 150, 0.8)';
                    } else {
                        ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
                    }

                    ctx.fillRect(
                        building.x + window.x,
                        canvas.height - building.height + window.y,
                        15,
                        20
                    );
                });
            });
        }

        // ì˜¥ìƒ ê·¸ë¦¬ê¸°
        function drawRooftop() {
            // ì˜¥ìƒ ë°”ë‹¥
            const rooftopY = canvas.height * 0.7;

            ctx.fillStyle = '#8B7355';
            ctx.fillRect(0, rooftopY, canvas.width, canvas.height - rooftopY);

            // ì˜¥ìƒ íƒ€ì¼
            ctx.strokeStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.lineWidth = 1;

            for (let x = 0; x < canvas.width; x += 50) {
                ctx.beginPath();
                ctx.moveTo(x, rooftopY);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }

            for (let y = rooftopY; y < canvas.height; y += 50) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }

            // ë‚œê°„
            ctx.fillStyle = '#666';
            ctx.fillRect(0, rooftopY - 5, canvas.width, 5);

            // ë‚œê°„ ê¸°ë‘¥
            for (let x = 0; x < canvas.width; x += 100) {
                ctx.fillRect(x, rooftopY - 50, 5, 50);
            }

            // í™”ë¶„ë“¤
            drawPlants();
        }

        // í™”ë¶„ ê·¸ë¦¬ê¸°
        function drawPlants() {
            const plants = [
                { x: 100, y: canvas.height * 0.7 - 30 },
                { x: 250, y: canvas.height * 0.7 - 30 },
                { x: canvas.width - 150, y: canvas.height * 0.7 - 30 }
            ];

            plants.forEach(plant => {
                // í™”ë¶„
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(plant.x - 20, plant.y, 40, 30);

                // ì‹ë¬¼
                ctx.fillStyle = '#228B22';
                ctx.beginPath();
                ctx.moveTo(plant.x, plant.y);
                ctx.lineTo(plant.x - 15, plant.y - 20);
                ctx.lineTo(plant.x, plant.y - 15);
                ctx.lineTo(plant.x + 15, plant.y - 25);
                ctx.lineTo(plant.x, plant.y - 10);
                ctx.closePath();
                ctx.fill();
            });
        }

        // ì¤€ë¹„ ì¤‘ì¸ ë¹„í–‰ê¸° ê·¸ë¦¬ê¸°
        function drawReadyPlane() {
            if (!readyPlane) return;

            // ì† ë–¨ë¦¼ íš¨ê³¼
            readyPlane.wobble += 0.1;
            const wobbleX = Math.sin(readyPlane.wobble) * 5;
            const wobbleY = Math.sin(readyPlane.wobble * 1.5) * 3;

            // íŒŒì›Œ í‘œì‹œ (ë¹„í–‰ê¸° í¬ê¸° ë³€í™”)
            const powerScale = 1 + (holdPower / 100) * 0.3;

            ctx.save();
            ctx.translate(readyPlane.x + wobbleX, readyPlane.y + wobbleY);
            ctx.scale(powerScale, powerScale);

            // ê·¸ë¦¼ì íš¨ê³¼
            ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
            ctx.shadowBlur = 30;
            ctx.shadowOffsetY = 20;

            // ì¢…ì´ë¹„í–‰ê¸° ê·¸ë¦¬ê¸°
            if (planeImage && planeImage.complete) {
                // ì´ë¯¸ì§€ë¡œ ê·¸ë¦¬ê¸°
                const imageSize = readyPlane.size * 1.5;
                ctx.drawImage(
                    planeImage,
                    -imageSize / 2,
                    -imageSize / 2,
                    imageSize,
                    imageSize
                );
            } else {
                // ê¸°ë³¸ ë„í˜•ìœ¼ë¡œ ê·¸ë¦¬ê¸° (ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ì‹œ)
                ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
                ctx.strokeStyle = 'rgba(100, 100, 100, 0.8)';
                ctx.lineWidth = 3;

                // ë¹„í–‰ê¸° ëª¸ì²´ (ìœ„ì—ì„œ ë³¸ ëª¨ìŠµ)
                ctx.beginPath();
                ctx.moveTo(0, -readyPlane.size);
                ctx.lineTo(-readyPlane.size * 0.7, readyPlane.size * 0.8);
                ctx.lineTo(0, readyPlane.size * 0.3);
                ctx.lineTo(readyPlane.size * 0.7, readyPlane.size * 0.8);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();

                // ì¤‘ì•™ ì ‘íŒ ì„ 
                ctx.beginPath();
                ctx.moveTo(0, -readyPlane.size);
                ctx.lineTo(0, readyPlane.size * 0.5);
                ctx.stroke();

                // ë‚ ê°œ ì ‘íŒ ì„ 
                ctx.beginPath();
                ctx.moveTo(-readyPlane.size * 0.5, 0);
                ctx.lineTo(0, readyPlane.size * 0.3);
                ctx.lineTo(readyPlane.size * 0.5, 0);
                ctx.stroke();
            }

            // íŒŒì›Œ ê²Œì´ì§€
            ctx.shadowBlur = 0;
            ctx.strokeStyle = `rgba(255, ${255 - holdPower * 2}, 0, 0.8)`;
            ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.arc(0, 0, readyPlane.size * 1.2, 0, (Math.PI * 2 * holdPower) / 100);
            ctx.stroke();

            // íŒŒì›Œ í…ìŠ¤íŠ¸
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.font = 'bold 20px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`${Math.floor(holdPower)}%`, 0, -readyPlane.size - 20);

            ctx.restore();
        }

        // ë¹„í–‰ê¸° ê·¸ë¦¬ê¸°
        function drawAirplanes() {
            for (let i = airplanes.length - 1; i >= 0; i--) {
                const plane = airplanes[i];

                // ë°œì‚¬ ì• ë‹ˆë©”ì´ì…˜
                if (plane.launching) {
                    plane.size *= 0.98;
                    if (plane.size < 10) {
                        plane.size = 10;
                        plane.launching = false;
                    }
                }

                // í¬ë¬¼ì„  ë¬¼ë¦¬ ì—…ë°ì´íŠ¸
                const timeFlying = (Date.now() - plane.thrown) / 1000; // ë¹„í–‰ ì‹œê°„(ì´ˆ)

                // ê³µê¸°ì €í•­ (ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ë” ë§ì´ ê°ì†Œ)
                plane.vy *= (0.98 - timeFlying * 0.002);
                plane.vx *= (0.99 - timeFlying * 0.001);

                // í¬ë¬¼ì„  ì¤‘ë ¥ (ì‹œê°„ì— ë”°ë¼ ê°€ì†ë„ì ìœ¼ë¡œ ì¦ê°€)
                plane.vz -= 0.12 + timeFlying * 0.03;

                // ë¶€ë“œëŸ¬ìš´ ë¹„í–‰ íŒ¨í„´ (ì•ìœ¼ë¡œ ë‚˜ê°€ëŠ” ëŠë‚Œ ìœ ì§€)
                plane.swayPhase += plane.swaySpeed;
                plane.spiralPhase += plane.spiralSpeed;

                // ë¶€ë“œëŸ¬ìš´ ì¢Œìš° í”ë“¤ë¦¼ (ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ì¤„ì–´ë“¦)
                const swayDecay = Math.max(0.1, 1 - timeFlying * 0.3);
                const sway = Math.sin(plane.swayPhase) * plane.swayIntensity * swayDecay;
                plane.vx += sway * 0.03;

                // ìì—°ìŠ¤ëŸ¬ìš´ ìƒí•˜ ì›¨ì´ë¸Œ (ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ì¤„ì–´ë“¦)
                const waveDecay = Math.max(0.1, 1 - timeFlying * 0.2);
                const wave = Math.cos(plane.spiralPhase) * 0.15 * waveDecay;
                plane.vy += wave * 0.03;

                // ì¢Œìš° ì†ë„ ì œí•œ (ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ë” ì œí•œ)
                const speedLimit = Math.max(1, 3 - timeFlying);
                plane.vx = Math.max(-speedLimit, Math.min(speedLimit, plane.vx));

                plane.x += plane.vx;
                plane.y += plane.vy;
                plane.z += plane.vz;

                // ë†’ì´ê°€ 0 ì´í•˜ê°€ ë˜ë©´ ë•…ì— ë–¨ì–´ì§
                if (plane.z <= 0) {
                    plane.z = 0;
                    plane.vy *= 0.5;
                    plane.vx *= 0.8;
                }

                // ê±°ë¦¬ ê³„ì‚°
                const flightDistance = Math.abs(canvas.height - 80 - plane.y);
                plane.distance = Math.floor(flightDistance / 3);

                if (plane.distance > bestDistance) {
                    bestDistance = plane.distance;
                    document.getElementById('best-distance').textContent = bestDistance + 'm';
                }

                // ê¼¬ë¦¬ ì¶”ê°€
                plane.trail.push({ x: plane.x, y: plane.y, size: plane.size });
                if (plane.trail.length > 15) {
                    plane.trail.shift();
                }

                // ê¼¬ë¦¬ ê·¸ë¦¬ê¸°
                ctx.strokeStyle = `rgba(255, 255, 255, 0.3)`;
                plane.trail.forEach((point, index) => {
                    if (index > 0) {
                        ctx.lineWidth = (index / plane.trail.length) * 3;
                        ctx.beginPath();
                        ctx.moveTo(plane.trail[index - 1].x, plane.trail[index - 1].y);
                        ctx.lineTo(point.x, point.y);
                        ctx.stroke();
                    }
                });

                // ê·¸ë¦¼ì
                const shadowScale = 1 - (plane.z / 200);
                ctx.fillStyle = `rgba(0, 0, 0, ${shadowScale * 0.3})`;
                ctx.beginPath();
                ctx.ellipse(
                    plane.x,
                    plane.y + plane.z,
                    plane.size * shadowScale,
                    plane.size * shadowScale * 0.3,
                    0, 0, Math.PI * 2
                );
                ctx.fill();

                // ì¢…ì´ë¹„í–‰ê¸° ê·¸ë¦¬ê¸° (ìœ„ì—ì„œ ë³¸ ëª¨ìŠµ)
                const displaySize = plane.size * (1 + plane.z / 100) * (0.5 + plane.opacity * 0.5);

                ctx.save();
                ctx.translate(plane.x, plane.y);

                // í”ë“¤ë¦¼ íš¨ê³¼ (í˜ì´ë“œì•„ì›ƒê³¼ í•¨ê»˜ ì¤„ì–´ë“¦)
                const wobbleIntensity = plane.opacity * 0.1;
                const wobble = Math.sin(Date.now() * 0.01 + plane.thrown) * wobbleIntensity;
                ctx.rotate(wobble);

                // íˆ¬ëª…ë„ì— ë”°ë¥¸ ìƒ‰ìƒ ì¡°ì •
                const alpha = Math.max(0, Math.min(1, plane.opacity));
                ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
                ctx.strokeStyle = `rgba(100, 100, 100, ${alpha * 0.8})`;
                ctx.lineWidth = Math.max(0.5, displaySize / 20);

                // ë¹„í–‰ê¸° ëª¨ì–‘ (ì´ë¯¸ì§€ ë˜ëŠ” ê¸°ë³¸ ë„í˜•)
                if (planeImage && planeImage.complete) {
                    // ì´ë¯¸ì§€ë¡œ ê·¸ë¦¬ê¸°
                    ctx.globalAlpha = alpha;
                    ctx.drawImage(
                        planeImage,
                        -displaySize / 2,
                        -displaySize / 2,
                        displaySize,
                        displaySize
                    );
                    ctx.globalAlpha = 1;
                } else {
                    // ê¸°ë³¸ ë„í˜•ìœ¼ë¡œ ê·¸ë¦¬ê¸° (ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ì‹œ)
                    ctx.beginPath();
                    ctx.moveTo(0, -displaySize);
                    ctx.lineTo(-displaySize * 0.6, displaySize * 0.7);
                    ctx.lineTo(0, displaySize * 0.2);
                    ctx.lineTo(displaySize * 0.6, displaySize * 0.7);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();

                    // ì¤‘ì•™ ì ‘íŒ ì„ 
                    ctx.beginPath();
                    ctx.moveTo(0, -displaySize);
                    ctx.lineTo(0, displaySize * 0.2);
                    ctx.stroke();
                }

                ctx.restore();

                // ë¹„í–‰ ì‹œê°„ ì²´í¬ (10ì´ˆ ì´ìƒ ì§€ë‚˜ë©´ ê°•ì œ ì œê±°)
                const flightTime = (Date.now() - plane.thrown) / 1000;
                if (flightTime > 10) {
                    plane.opacity -= 0.05; // 10ì´ˆ í›„ì—” ë¹ ë¥´ê²Œ ì‚¬ë¼ì§
                }

                // ì ì§„ì  í˜ì´ë“œ ì•„ì›ƒ ì‹œìŠ¤í…œ
                const fadeDistance = Math.sqrt(
                    Math.pow(plane.x - canvas.width / 2, 2) +
                    Math.pow(plane.y - (canvas.height - 80), 2)
                );

                // ê±°ë¦¬ì™€ ë†’ì´ì— ë”°ë¥¸ í˜ì´ë“œ ì•„ì›ƒ (ë” ì ê·¹ì ìœ¼ë¡œ)
                if (plane.y < canvas.height * 0.3) {
                    plane.opacity -= 0.015; // í™”ë©´ ìƒë‹¨ì—ì„œ ë¹ ë¥´ê²Œ ì‚¬ë¼ì§
                } else if (plane.y < canvas.height * 0.5) {
                    plane.opacity -= 0.010; // ì¤‘ê°„ ë†’ì´ì—ì„œë„ ë¹ ë¥´ê²Œ
                } else if (plane.y < canvas.height * 0.7) {
                    plane.opacity -= 0.006;
                } else if (fadeDistance > 250) {
                    plane.opacity -= 0.004; // ê±°ë¦¬ ì„ê³„ê°’ ë‚®ì¶¤
                }

                // ë•…ì— ë–¨ì–´ì§€ë©´ ë” ë¹¨ë¦¬ ì‚¬ë¼ì§
                if (plane.z <= 0 && plane.y > canvas.height * 0.7) {
                    plane.opacity -= 0.03; // ë” ë¹ ë¥´ê²Œ ì‚¬ë¼ì§
                }

                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°„ ë¹„í–‰ê¸°ë„ ë¹ ë¥´ê²Œ ì œê±°
                if (plane.x < -100 || plane.x > canvas.width + 100 ||
                    plane.y < -50 || plane.y > canvas.height + 50) {
                    plane.opacity -= 0.02;
                }

                // ì•„ì£¼ ì‘ì•„ì§€ê±°ë‚˜ ê±°ì˜ íˆ¬ëª…í•´ì§€ë©´ ê°•ì œ ì œê±°
                if (plane.size < 5 || plane.opacity <= 0.01) {
                    airplanes.splice(i, 1);
                    continue;
                }

                // ì™„ì „íˆ íˆ¬ëª…í•´ì§€ê±°ë‚˜ í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ì œê±° (ë²”ìœ„ í™•ëŒ€)
                if (plane.opacity <= 0 ||
                    plane.y < -150 ||
                    plane.x < -300 ||
                    plane.x > canvas.width + 300 ||
                    plane.y > canvas.height + 100) {
                    airplanes.splice(i, 1);
                    continue;
                }
            }
        }

        // ìŒì•… í† ê¸€
        function toggleMusic() {
            const btn = document.getElementById('music-btn');
            const audio = document.getElementById('backgroundMusic');
            musicPlaying = !musicPlaying;

            if (musicPlaying) {
                btn.textContent = 'ğŸµ ë°°ê²½ìŒì•… OFF';
                audio.play().catch(error => {
                    console.log('ì˜¤ë””ì˜¤ ì¬ìƒ ì‹¤íŒ¨:', error);
                    // ìë™ì¬ìƒì´ ì°¨ë‹¨ëœ ê²½ìš° ì‚¬ìš©ìê°€ ì§ì ‘ í´ë¦­í•´ì•¼ í•¨
                    musicPlaying = false;
                    btn.textContent = 'ğŸµ ë°°ê²½ìŒì•… ON';
                });
            } else {
                btn.textContent = 'ğŸµ ë°°ê²½ìŒì•… ON';
                audio.pause();
            }
        }

        // ì°½ í¬ê¸° ì¡°ì ˆ
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // ì‹œì‘
        loadImages();
        init();
    </script>
</body>
</html>